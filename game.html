
<!doctype html>
<html lang="id">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Tiga Game ‚Äî Main untuk Lanjut</title>
		<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;800&display=swap" rel="stylesheet">
	<style>
		:root{--bg:#0f1724;--card:#0b1220;--accent:#1fb6ff;--muted:#9aa4b2}
		*{box-sizing:border-box;font-family:'Poppins',Inter,Segoe UI,Arial,Helvetica,sans-serif}
		html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071029);color:#e6eef6}
		header{position:fixed;top:12px;left:12px;z-index:30}
		#menuBtn{background:transparent;border:0;color:var(--accent);font-size:22px;cursor:pointer}
		#sideMenu{background:rgba(10,14,20,0.95);padding:12px;border-radius:8px;color:var(--muted)}
		.hidden{display:none}
		main{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;padding:24px}
		.overlay{background:rgba(2,6,12,0.6);padding:28px;border-radius:12px;text-align:center;display:flex;flex-direction:column;align-items:center}
		.overlay h1{margin:0 0 16px 0;max-width:820px;font-size:26px;line-height:1.28;text-align:center;word-break:break-word;overflow-wrap:break-word;white-space:normal;letter-spacing:0.2px}
		@media (max-width:480px){.overlay h1{font-size:18px;padding:0 8px}}
		/* Title banner shown after Start */
		.title{font-family:'Baloo 2', 'Poppins', sans-serif;color:#fff8fb;background:linear-gradient(90deg,#ff8fb1,#ffb3e0);padding:10px 18px;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,0.35);font-size:28px;line-height:1.1;text-align:center;margin-bottom:12px;max-width:900px;word-break:break-word}
		.title.hidden{display:none}
		@media (max-width:720px){.title{font-size:20px;padding:10px 12px}}
		@keyframes titlePop{0%{transform:translateY(-10px) scale(.98);opacity:0}60%{transform:translateY(6px) scale(1.03);opacity:1}100%{transform:translateY(0) scale(1)}}
		.title.show{animation:titlePop .5s ease forwards}
		.overlay button{font-size:18px;padding:10px 18px;border-radius:8px;border:0;background:var(--accent);color:#012233;cursor:pointer}
		.card-grid{display:flex;gap:20px;margin-top:28px;justify-content:center;align-items:flex-start}
		.card{background:var(--card);padding:18px;border-radius:12px;width:320px;box-shadow:0 8px 24px rgba(0,0,0,0.45);display:flex;flex-direction:column;align-items:center}
		.card h3{margin:0 0 8px 0}
		.card p{margin:0 0 12px 0;color:var(--muted)}
		.card .playBtn{background:linear-gradient(90deg,var(--accent),#5ce1ff);border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
		.playBtn.disabled{opacity:0.6;cursor:not-allowed}
		.status{margin-top:10px;color:var(--muted)}
		#gameArea{max-width:900px;width:100%;margin-top:18px}
		#gameContainer{background:rgba(2,6,12,0.55);padding:18px;border-radius:10px;min-height:240px}
		#backToSelect{background:#142235;border:0;color:var(--accent);padding:6px 10px;border-radius:6px;cursor:pointer;margin-bottom:12px}
		footer{position:fixed;right:16px;bottom:12px;color:var(--muted)}
		.playfield{width:100%;height:360px;background:linear-gradient(180deg,#0e2133,#071222);border-radius:10px;position:relative;overflow:hidden}
		.dot{position:absolute;width:56px;height:56px;background:radial-gradient(circle,#ffd166,#ff7b7b);border-radius:50%;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
			.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;width:100%}
		.card-tile{background:#08121a;padding:22px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:22px;cursor:pointer}
		.card-tile.flipped{background:linear-gradient(90deg,#2b5f85,#5fb1d7);color:#012;cursor:default}
		.ok{color:#8ef5a4}
		.locked{color:var(--muted)}
		@media (max-width:720px){.card-grid{flex-direction:column;align-items:center}.card{width:100%}}
		/* Popup */
		.popup{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:9999;display:flex;align-items:center;justify-content:center;width:100%;height:100%}
		.popup.hidden{display:none}
		.popup-backdrop{position:fixed;inset:0;background:rgba(2,6,12,0.65)}
		.popup-content{background:linear-gradient(180deg,#071022,#0e2133);padding:18px 20px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,12,0.8);color:#e6f8ff;min-width:260px;max-width:420px;text-align:center;transform:scale(.9);opacity:0;animation:popIn .45s forwards;position:relative;z-index:10000}
		.popup-message{font-size:16px;margin-bottom:12px}
		.popup-sub{font-size:13px;color:var(--muted)}
		.popup button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#012233;cursor:pointer}
		@keyframes popIn{0%{transform:translateY(-6px) scale(.9);opacity:0}60%{transform:translateY(6px) scale(1.03);opacity:1}100%{transform:translateY(0) scale(1)}}
		@keyframes popOut{to{transform:translateY(-10px) scale(.9);opacity:0}}
		/* music button (fixed to top-right) */
		.music-btn{position:fixed;right:12px;top:12px;background:transparent;border:0;color:var(--accent);font-size:20px;cursor:pointer;z-index:60;padding:6px;border-radius:8px}
		.music-btn.playing{color:#ffd166;transform:scale(1.05)}

		/* glow theme for music intro popup */
		.popup-content.music-glow{box-shadow:0 12px 50px rgba(50,160,255,0.18), inset 0 0 30px rgba(40,140,255,0.06);border:1px solid rgba(80,180,255,0.18);}
		.popup-message.music-title{font-family:'Baloo 2', 'Poppins', sans-serif;font-size:20px;color:#dff6ff;text-shadow:0 2px 14px rgba(80,180,255,0.28)}
	</style>
</head>
<body>
	<header>
		<button id="musicBtn" aria-label="putar musik" title="Putar Lagu" class="music-btn">üîà</button>
		<button id="menuBtn" aria-label="menu">‚ò∞</button>
		<nav id="sideMenu" class="hidden">
			<ul style="list-style:none;margin:0;padding:0;">
				<li style="margin-bottom:8px"><button id="resetBtn">Atur Ulang Progres</button></li>
				<li><button id="gotoNextBtn" disabled>Lanjutkan (terkunci)</button></li>
			</ul>
		</nav>
	</header>

	<main>
		<div id="welcome" class="overlay">
			<h1>ajuz ada sedikit game bagus niii buat nanaaa, dimainin duluuw yaaa!!</h1>
			<button id="startBtn">Mulai</button>
		</div>

		<!-- title banner that appears after Start -->
		<div id="titleBanner" class="title hidden" aria-hidden="true">Selamatttt mencobaaa yaaw sayangkuuuu üòùü§ç</div>

		<section id="selector" class="card-grid hidden">
			<div class="card">
				<h3>1. Tangkap Titik</h3>
				<p>Klik titik yang bergerak sebanyak 5 kali dalam 25 detik.</p>
				<button class="playBtn" data-game="game1">Main</button>
				<div class="status" id="status-game1">Terkunci</div>
			</div>

			<div class="card">
				<h3>2. Cocokkan Pasangan</h3>
				<p>Balikkan kartu dan cocokkan semua pasangannya.</p>
				<button class="playBtn" data-game="game2">Main</button>
				<div class="status" id="status-game2">Terkunci</div>
			</div>

			<div class="card">
				<h3>3. Tantangan Matematika</h3>
				<p>Jawab 3 soal matematika cepat dengan benar.</p>
				<button class="playBtn" data-game="game3">Main</button>
				<div class="status" id="status-game3">Terkunci</div>
			</div>
		</section>

		<section id="gameArea" class="hidden">
			<button id="backToSelect">‚Üê Kembali</button>
			<div id="gameContainer"></div>
		</section>
	</main>

	<footer>
		<div id="progress">Progres: <span id="progressCount">0</span>/3</div>
	</footer>

	<!-- Animated popup (used instead of alert()) -->
	<div id="popup" class="popup hidden" aria-live="polite">
		<div class="popup-backdrop"></div>
		<div class="popup-content" role="dialog" aria-modal="true">
			<div class="popup-message" id="popupMessage"></div>
			<div class="popup-sub" id="popupSub"></div>
			<div style="margin-top:12px"><button id="popupOk">Oke</button></div>
		</div>
	</div>

	<!-- Background music (hidden audio element) -->
	<audio id="bgMusic" preload="none" loop>
		<source src="https://www.dropbox.com/scl/fi/9qli5qeljhal87xnlangz/Sempurna-Instrumental-SlowedReverb-by-Andra-and-The-BackBone-Shinkai-Clips-AMV.mp3?rlkey=bfypwk5ihij43p0qrggdekxf6&st=syphtiza&dl=1" type="audio/mpeg">
		Your browser does not support the audio element.
	</audio>

	<script>
		// Progress (do NOT persist across page refresh)
		const STORAGE_KEY = 'threeGamesProgress_v1';
		const defaultState = {game1:false,game2:false,game3:false};
		// Always start fresh on page load. Remove any previous saved data to avoid confusion.
		function loadState(){
			try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
			return {...defaultState};
		}
		// No-op: do not save state to localStorage so refresh resets progress.
		function saveState(s){}

		let state = loadState();

		// UI refs
		const startBtn = document.getElementById('startBtn');
		const welcome = document.getElementById('welcome');
		const selector = document.getElementById('selector');
		const playBtns = document.querySelectorAll('.playBtn');
		let started = false; // user must press Start before playing
		const gameArea = document.getElementById('gameArea');
		const gameContainer = document.getElementById('gameContainer');
		const backToSelect = document.getElementById('backToSelect');
		const progressCount = document.getElementById('progressCount');
		const statusEls = {game1:document.getElementById('status-game1'),game2:document.getElementById('status-game2'),game3:document.getElementById('status-game3')};
		const menuBtn = document.getElementById('menuBtn');
		const sideMenu = document.getElementById('sideMenu');
		const resetBtn = document.getElementById('resetBtn');
		const gotoNextBtn = document.getElementById('gotoNextBtn');

		function updateUI(){
			const won = Object.values(state).filter(Boolean).length;
			progressCount.textContent = won;
			for(const k of ['game1','game2','game3']){
				statusEls[k].textContent = state[k] ? 'Selesai' : 'Terkunci';
				statusEls[k].className = state[k] ? 'status ok' : 'status locked';
			}
			if(won>=3){
				gotoNextBtn.disabled = false; gotoNextBtn.textContent = 'Lanjutkan (terbuka)';
			} else { gotoNextBtn.disabled = true; gotoNextBtn.textContent = 'Lanjutkan (terkunci)'; }
		}

		startBtn.addEventListener('click',()=>{
			// hide and remove welcome overlay
			welcome.classList.add('hidden');
			selector.classList.remove('hidden');
			try{ welcome.remove(); }catch(e){}
			started = true;
			// show title banner and animate
			const titleBanner = document.getElementById('titleBanner');
			if(titleBanner){ titleBanner.classList.remove('hidden'); titleBanner.classList.add('show'); titleBanner.setAttribute('aria-hidden','false'); }
			// visually enable play buttons and refresh disabled property
			playBtns.forEach(b=>{ b.classList.remove('disabled'); b.removeAttribute('aria-disabled'); });
			try{ refreshButtons(); }catch(e){}
		});
		menuBtn.addEventListener('click',()=>{sideMenu.classList.toggle('hidden')});
		resetBtn.addEventListener('click',()=>{state={...defaultState};saveState(state);updateUI();showPopup('Progres direset')});
		gotoNextBtn.addEventListener('click',()=>{
			// Buka halaman berikutnya ‚Äî ubah URL jika mau target lain
			window.location.href = 'https://example.com';
		});

		// Helper: determine if a game may be played (sequential rules)
		function canPlay(gameId){
			if(!started) return false;
			if(gameId==='game1') return true;
			if(gameId==='game2') return !!state.game1;
			if(gameId==='game3') return !!state.game2;
			return false;
		}

		// Refresh play buttons state according to progress and started flag
		function refreshButtons(){
			playBtns.forEach(b=>{
				const g = b.dataset.game;
				if(canPlay(g)){
					b.classList.remove('disabled'); b.removeAttribute('aria-disabled'); b.disabled = false;
				} else {
					b.classList.add('disabled'); b.setAttribute('aria-disabled','true'); b.disabled = true;
				}
			});
		}

		// initially mark all play buttons disabled until Start pressed
		playBtns.forEach(b=>{ b.classList.add('disabled'); b.setAttribute('aria-disabled','true'); b.disabled = true; });

		playBtns.forEach(b=>b.addEventListener('click',(e)=>{
			const g = b.dataset.game;
			if(!canPlay(g)){
				if(!started){
					showPopup('Naa harus pencet tombol start duluuww yaaaw!!','',{autoHide:false});
					return;
				}
				// If game1 not finished, forbid game2 and game3 with requested message
				if((g==='game2' || g==='game3') && !state.game1){
					showPopup('Naa harus nyelesaiin game 1 duluu yaww!','',{autoHide:false});
					return;
				}
				// other sequential messages
				if(g==='game2') showPopup('Selesaikan Game 1 dulu baru bisa main Game 2 ya!','',{autoHide:false});
				else if(g==='game3') showPopup('Selesaikan Game 2 dulu baru bisa main Game 3 ya!','',{autoHide:false});
				else showPopup('Permainan belum tersedia.','',{autoHide:false});
				return;
			}
			startGame(g);
		}));
		backToSelect.addEventListener('click',()=>{gameArea.classList.add('hidden');selector.classList.remove('hidden');gameContainer.innerHTML=''});

		updateUI();

		// Game loader
		function startGame(gameId){selector.classList.add('hidden');gameArea.classList.remove('hidden');gameContainer.innerHTML='';
			if(gameId==='game1') loadGame1();
			if(gameId==='game2') loadGame2();
			if(gameId==='game3') loadGame3();
		}

		// ------- Game 1: Catch The Dot -------
		function loadGame1(){
			const wrapper = document.createElement('div');
			wrapper.innerHTML = `
					<h2>Tangkap Titik ‚Äî Versi Seru</h2>
					<p>Kumpulkan poin dengan menangkap titik-titik yang bergerak. Beberapa titik memberikan poin lebih!</p>
					<div class="playfield" id="pf"></div>
					<div style="display:flex;gap:12px;margin-top:10px;align-items:center">
						<div>Skor: <strong id="ctdScore">0</strong></div>
						<div>Target: <strong id="ctdTarget">100</strong></div>
						<div>Combo: <strong id="ctdCombo">0</strong></div>
						<div>Waktu: <strong id="ctdTime">30</strong>s</div>
					</div>
				`;
			gameContainer.appendChild(wrapper);
			const pf = document.getElementById('pf');
			const scoreEl = document.getElementById('ctdScore');
			const targetEl = document.getElementById('ctdTarget');
			const comboEl = document.getElementById('ctdCombo');
			const timeEl = document.getElementById('ctdTime');

			let score = 0; let combo = 0; let comboTimer = null; const target = 100; targetEl.textContent = target;
			let timeLeft = 30; timeEl.textContent = timeLeft;
			let dots = []; let moveInterval = null; let globalTimer = null;

			// simple audio chime for hits (AudioContext)
			let aCtx = null; function playChime(f=880,d=0.12){ try{ if(!aCtx) aCtx = new (window.AudioContext||window.webkitAudioContext)(); const o=aCtx.createOscillator(); const g=aCtx.createGain(); o.type='sine'; o.frequency.value=f; g.gain.value=0.04; o.connect(g); g.connect(aCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, aCtx.currentTime + d); setTimeout(()=>o.stop(), (d+0.05)*1000); }catch(e){} }

			// create a particle sparkle at x,y
			function spawnSpark(x,y){ const p = document.createElement('div'); p.style.position='absolute'; p.style.left = x+'px'; p.style.top = y+'px'; p.style.width='12px'; p.style.height='12px'; p.style.borderRadius='50%'; p.style.background = 'radial-gradient(circle,#fff6b3,#ffd166)'; p.style.pointerEvents='none'; p.style.transform='translate(-50%,-50%) scale(0.6)'; p.style.opacity='1'; p.style.transition='transform .5s ease, opacity .6s ease'; pf.appendChild(p); requestAnimationFrame(()=>{ p.style.transform='translate(-50%,-50%) scale(1.8)'; p.style.opacity='0'; }); setTimeout(()=>p.remove(),700);
			}

			function makeDot(opts={value:1, size:48, power:null}){
				const d = document.createElement('div'); d.className='dot'; d.style.width = opts.size+'px'; d.style.height = opts.size+'px'; d.style.background = (opts.power==='gold' ? 'radial-gradient(circle,#fff2e6,#ffb86b)' : 'radial-gradient(circle,#ffd166,#ff7b7b)');
				d.style.cursor = 'pointer'; d.dataset.value = opts.value; d.dataset.power = opts.power || '';
				pf.appendChild(d);
				const obj = {el:d, vx: (Math.random()-0.5)*8, vy:(Math.random()-0.5)*6};
				d.addEventListener('click', (ev)=>{
					const rect = pf.getBoundingClientRect(); const cx = ev.clientX - rect.left; const cy = ev.clientY - rect.top;
					// score
					let val = Number(d.dataset.value)||1;
					if(combo>1) val = Math.floor(val * (1 + combo*0.2));
					score += val; scoreEl.textContent = score;
					// combo
					combo++; comboEl.textContent = combo; clearTimeout(comboTimer); comboTimer = setTimeout(()=>{ combo=0; comboEl.textContent = 0; }, 2200);
					playChime(880 + val*60, 0.08);
					spawnSpark(cx,cy);
					// gold bonus (no time power-up in this mode)
					if(d.dataset.power==='gold'){ score += 4; scoreEl.textContent = score; playChime(1200,0.12); }
					// remove dot
					cleanupDot(obj);
					// check win
					if(score>=target){ finish(true); }
				});
				dots.push(obj);
				return obj;
			}

			function cleanupDot(obj){ try{ obj.el.remove(); }catch(e){} const idx = dots.indexOf(obj); if(idx>=0) dots.splice(idx,1); }

			// spawn a set of dots with occasional power-ups
			function spawnWave(){
				// spawn dots from corners moving inward, keep lively but cap total
				const pw = pf.clientWidth; const ph = pf.clientHeight;
				const corners = [ {x:8,y:8}, {x:pw-56,y:8}, {x:8,y:ph-56}, {x:pw-56,y:ph-56} ];
				while(dots.length < 8){
					const corner = corners[Math.floor(Math.random()*corners.length)];
					const roll = Math.random();
					if(roll < 0.12){
						const obj = makeDot({value:3,size:36,power:'gold'});
						obj.x = corner.x; obj.y = corner.y;
						obj.vx = (pw/2 - obj.x)/40 + (Math.random()-0.5)*3; obj.vy = (ph/2 - obj.y)/40 + (Math.random()-0.5)*3;
						obj.el.style.transform = `translate(${Math.floor(obj.x)}px,${Math.floor(obj.y)}px)`;
					} else {
						const size = 44 - Math.floor(Math.random()*6);
						const val = 1 + Math.floor(Math.random()*3);
						const obj = makeDot({value:val,size:size});
						obj.x = corner.x; obj.y = corner.y;
						obj.vx = (pw/2 - obj.x)/40 + (Math.random()-0.5)*3; obj.vy = (ph/2 - obj.y)/40 + (Math.random()-0.5)*3;
						obj.el.style.transform = `translate(${Math.floor(obj.x)}px,${Math.floor(obj.y)}px)`;
					}
				}
			}

			// movement loop
			function stepDots(){ dots.forEach(o=>{
				const el = o.el; const pw = pf.clientWidth - (parseInt(el.style.width)||56); const ph = pf.clientHeight - (parseInt(el.style.height)||56);
				let x = (o.x||0) + o.vx* (0.8 + Math.random()*0.6);
				let y = (o.y||0) + o.vy* (0.8 + Math.random()*0.6);
				// bounce
				if(x < 8 || x > pw-8){ o.vx *= -1; x = Math.max(8, Math.min(pw-8, x)); }
				if(y < 8 || y > ph-8){ o.vy *= -1; y = Math.max(8, Math.min(ph-8, y)); }
				o.x = x; o.y = y; el.style.transform = `translate(${Math.floor(x)}px,${Math.floor(y)}px)`;
			});
			}

			// global timer tick
			function tick(){ timeLeft--; if(timeLeft<0) timeLeft=0; timeEl.textContent = timeLeft; if(timeLeft<=0){ finish(false); } }

			// start game
			spawnWave(); moveInterval = setInterval(()=>{ stepDots(); if(Math.random()<0.18) spawnWave(); }, 120);
			globalTimer = setInterval(tick, 1000);

			// cleanup helpers
			let cleaned=false;
			function cleanup(){ if(cleaned) return; cleaned=true; try{ clearInterval(moveInterval); }catch(e){} try{ clearInterval(globalTimer); }catch(e){} try{ clearTimeout(comboTimer); }catch(e){} try{ dots.forEach(d=>{ if(d && d.el) d.el.remove(); }); dots=[]; }catch(e){} try{ backToSelect.removeEventListener('click', onBack); }catch(e){} }

			const onBack = ()=>{ cleanup(); };
			backToSelect.addEventListener('click', onBack);

			function finish(win){ cleanup(); if(win){ markWon('game1','Yeay! Pinterr yhh cewekkuu.'); } else { showPopup('Waktu habis! Coba lagi.','',{autoHide:false}); }
			}
		}

		// ------- Game 2: Memory Match -------
		function loadGame2(){
			// 3x3 memory: 3 groups of 3 (triples) = 9
			const wrapper = document.createElement('div');
			wrapper.innerHTML = `
				<h2>Cocokkan Tiga (3x3)</h2>
				<p>Balikkan kartu dan cocokkan tiga objek yang sama (3 gitar, 3 kelinci, 3 rendang).</p>
				<div class="grid" id="memGrid"></div>
			`;
			gameContainer.appendChild(wrapper);
			const grid = document.getElementById('memGrid');
			// use only three emojis: gitar, kelinci, rendang
			const symbols = ['üé∏','üê∞','üçõ'];
			let deck = [];
			// create 3-of-a-kind for each symbol to fill 9 tiles
			symbols.forEach(s=>{ deck.push(s); deck.push(s); deck.push(s); });
			// shuffle
			deck = deck.sort(()=>Math.random()-0.5);
			let flipped = [];
			// build grid
			deck.forEach((v,i)=>{
				const t = document.createElement('div'); t.className='card-tile'; t.textContent=''; t.dataset.val = v; t.dataset.index = i; t.dataset.matched = 'false';
				t.addEventListener('click',()=>{
					if(t.classList.contains('flipped') || t.dataset.matched==='true' || flipped.length===3) return;
					// flip
					t.classList.add('flipped');
					t.textContent = v;
					flipped.push(t);
					if(flipped.length===3){
						const [a,b,c] = flipped;
						const valA = a.dataset.val, valB = b.dataset.val, valC = c.dataset.val;
						// match only if all three equal
						if(valA === valB && valB === valC){
							[a,b,c].forEach(x=>{ x.dataset.matched='true'; x.classList.add('matched'); });
							setTimeout(()=>{
								const remaining = grid.querySelectorAll('.card-tile:not(.matched)').length;
								if(remaining===0){ markWon('game2','Hmzz! Jago ternyata cewekkuu yhh.'); }
							},200);
							flipped = [];
						} else {
							setTimeout(()=>{ flipped.forEach(x=>{ x.classList.remove('flipped'); x.textContent=''; }); flipped = []; },700);
						}
					}
				});
				grid.appendChild(t);
			});
		}

		// ------- Game 3: Math Quickfire -------
		function loadGame3(){
			const wrapper = document.createElement('div');
			wrapper.innerHTML = `
					<h2>Tantangan Matematika</h2>
					<p>Jawab 3 soal matematika cepat. Masukkan jawaban lalu tekan Kirim.</p>
					<div id="mq"></div>
					<div style="margin-top:8px">Waktu: <span id="mqTimer">20</span>s</div>
					<div style="margin-top:10px"><button id="submitMath">Kirim</button></div>
				`;
			gameContainer.appendChild(wrapper);
			const mq = document.getElementById('mq');
			const submit = document.getElementById('submitMath');
			const mqTimerEl = document.getElementById('mqTimer');
			const qs = [];
			for(let i=0;i<3;i++){
				const a = Math.ceil(Math.random()*9);
				const b = Math.ceil(Math.random()*9);
				const op = ['+','-','*'][Math.floor(Math.random()*3)];
				let ans=0; if(op==='+')ans=a+b; if(op==='-')ans=a-b; if(op==='*')ans=a*b;
				qs.push({a,b,op,ans});
			}
			qs.forEach((q,i)=>{ const row = document.createElement('div'); row.style.marginTop='8px'; row.innerHTML = `<label>${q.a} ${q.op} ${q.b} = <input data-idx="${i}" type="number" style="width:80px"></label>`; mq.appendChild(row); });

			// countdown timer (20s)
			let mqTime = 20;
			mqTimerEl.textContent = mqTime;
			let mqInterval = setInterval(()=>{
				mqTime--;
				if(mqTimerEl) mqTimerEl.textContent = mqTime;
				if(mqTime<=0){
					clearInterval(mqInterval);
					// time up: close game and notify
					try{ gameArea.classList.add('hidden'); selector.classList.remove('hidden'); gameContainer.innerHTML = ''; }catch(e){}
					showPopup('Yahh kurang cepet','Cobaa lagii yaa sayangkuuw! :D',{autoHide:false});
				}
			},1000);

			// ensure timer cleared on back button
			const onBack = ()=>{ clearInterval(mqInterval); backToSelect.removeEventListener('click', onBack); };
			backToSelect.addEventListener('click', onBack);

			submit.addEventListener('click',()=>{
				clearInterval(mqInterval);
				backToSelect.removeEventListener('click', onBack);
				let ok=true; qs.forEach((q,i)=>{ const v = Number(mq.querySelector(`input[data-idx="${i}"]`).value); if(v!==q.ans) ok=false; });
				if(ok) markWon('game3','Semua jawaban benar!'); else showPopup('Beberapa jawaban salah. Coba lagi.','',{autoHide:false});
			});
		}

		// Mark won and persist
		function markWon(gameId,message){ if(state[gameId]){ showPopup('Sudah selesai'); return; } state[gameId]=true; saveState(state); updateUI(); showPopup(message + ' üéâ'); }

		// after state changes, ensure buttons reflect the new permissions
		const origMarkWon = markWon;
		markWon = function(gameId,message){
			if(state[gameId]){ showPopup('Sudah selesai'); return; }
			state[gameId]=true; saveState(state); updateUI();
			// refresh which buttons are allowed next
			try{ refreshButtons(); }catch(e){}
			// close the current game and return to selector (for single-game wins)
			try{ gameArea.classList.add('hidden'); selector.classList.remove('hidden'); gameContainer.innerHTML = ''; }catch(e){}
			// if all games completed -> remove title and game area, then show final popup with 'Lanjut'
			const allDone = Object.values(state).every(v=>v===true);
			if(allDone){
				// remove the title and selector/game area (already cleared above)
				try{ const titleBanner = document.getElementById('titleBanner'); if(titleBanner) titleBanner.remove(); }catch(e){}
				try{ const selectorEl = document.getElementById('selector'); if(selectorEl) selectorEl.remove(); }catch(e){}
				try{ const gameAreaEl = document.getElementById('gameArea'); if(gameAreaEl) gameAreaEl.remove(); }catch(e){}
				// show final popup and on OK navigate to local index.html
				showPopup("WOKAIIII, NAAA HEBATT SUDAHH SELESAIII SEMUANYAAA!!, lanjutt ke web selanjutnyaa ya naa!!", '', {autoHide:false, onOk:()=>{ try{ bgMusic.pause(); }catch(e){}; window.location.href = 'next.html'; }, buttonText:'Lanjut'});
				return;
			}
			showPopup(message + ' üéâ');
		}

		// Popup helper ‚Äî now centered and supports onOk callback
		const popup = document.getElementById('popup');
		const popupMessage = document.getElementById('popupMessage');
		const popupSub = document.getElementById('popupSub');
		const popupOk = document.getElementById('popupOk');
		let popupTimeout = null;
		let popupOnOk = null;
		function showPopup(msg, sub='', opts={autoHide:false, onOk:null, buttonText:'Oke'}){
			popupMessage.textContent = msg;
			popupSub.textContent = sub;
			// if this is the music intro, give title style
			try{ popupMessage.classList.toggle('music-title', opts && opts.buttonText && opts.buttonText==='Oke' && msg && msg.toLowerCase().includes('sempurna')); }catch(e){}
			popup.classList.remove('hidden');
			// ensure popup elements are visible even if animation didn't run
			const contentEl = popup.querySelector('.popup-content');
			if(contentEl){
				contentEl.style.opacity = '1';
				contentEl.style.transform = 'translateY(0) scale(1)';
				contentEl.style.zIndex = 10001;
			}
			if(popupBackdrop){ popupBackdrop.style.zIndex = 10000; popupBackdrop.style.display = 'block'; }
			// prevent page shifting and ensure overlay is on top
			try{ document.body.style.overflow = 'hidden'; }catch(e){}
			popupOnOk = typeof opts.onOk === 'function' ? opts.onOk : null;
			// set button text
			try{ popupOk.textContent = opts.buttonText || 'Oke'; }catch(e){}
			// if onOk provided, do not auto-hide ‚Äî wait for user to press OK
			clearTimeout(popupTimeout);
			if(opts.autoHide && !popupOnOk){
				popupTimeout = setTimeout(()=>hidePopup(), 3200);
			}
			// focus OK button for accessibility
			setTimeout(()=>popupOk.focus(),100);
		}

		// prevent backdrop clicks from closing popup and disable main interactions
		const popupBackdrop = document.querySelector('.popup-backdrop');
		if(popupBackdrop){
			popupBackdrop.addEventListener('click', (e)=>{ e.stopPropagation(); e.preventDefault(); });
		}

		// disable Escape key closing the popup
		document.addEventListener('keydown', (e)=>{
			if(!popup.classList.contains('hidden') && e.key === 'Escape'){
				e.preventDefault(); e.stopPropagation();
			}
		});
		function hidePopup(){
			const content = popup.querySelector('.popup-content');
			content.style.animation = 'popOut .25s forwards';
			setTimeout(()=>{ content.style.animation=''; popup.classList.add('hidden'); },260);
			popupOnOk = null;
			try{ document.body.style.overflow = ''; }catch(e){}
			// reset button text to default
			try{ popupOk.textContent = 'Oke'; }catch(e){}
		}

		// ensure main is not interactive while popup shown
		const mainEl = document.querySelector('main');
		const setMainInteractive = (enabled)=>{
			if(mainEl) mainEl.style.pointerEvents = enabled ? '' : 'none';
		}

		// adjust show/hide to toggle main interaction
		const originalShowPopup = showPopup;
		showPopup = function(msg, sub='', opts={autoHide:false, onOk:null}){
			setMainInteractive(false);
			originalShowPopup(msg, sub, opts);
		}
		const originalHidePopup = hidePopup;
		hidePopup = function(){ setMainInteractive(true); originalHidePopup(); }
		popupOk.addEventListener('click',()=>{
			// call callback if any, then hide
			if(popupOnOk) try{ popupOnOk(); } catch(e){ console.error(e); }
			hidePopup();
		});

		// Music controls
		const musicBtn = document.getElementById('musicBtn');
		const bgMusic = document.getElementById('bgMusic');
		let musicPlaying = false;
		if(musicBtn && bgMusic){
			musicBtn.addEventListener('click', ()=>{
				if(bgMusic.paused){
					bgMusic.play().then(()=>{
						musicPlaying = true; musicBtn.classList.add('playing'); musicBtn.textContent = 'üîä'; musicBtn.title='Hentikan Lagu';
					}).catch(err=>{
						showPopup('Tidak dapat memutar lagu. Klik lagi untuk mencoba.','',{autoHide:false});
					});
				} else {
					bgMusic.pause(); musicPlaying = false; musicBtn.classList.remove('playing'); musicBtn.textContent = 'üîà'; musicBtn.title='Putar Lagu';
				}
			});
			// stop music when navigating away via Lanjut
			window.addEventListener('beforeunload', ()=>{ try{ bgMusic.pause(); }catch(e){} });
		}

		// Show music intro popup with glow-blue theme
		function showMusicIntro(){
			const content = popup.querySelector('.popup-content');
			if(content) content.classList.add('music-glow');
			showPopup('Sempurna Instrumental', 'Klik Oke, Untuk memulai musiknyaaa yaa sayangkuu :3', {autoHide:false, onOk:()=>{
				// try to play when user presses OK (some browsers require user gesture)
				if(bgMusic && bgMusic.paused){
					bgMusic.play().then(()=>{
						musicPlaying = true; musicBtn.classList.add('playing'); musicBtn.textContent = 'üîä'; musicBtn.title='Hentikan Lagu';
					}).catch(()=>{
						// still blocked or error
					});
				}
				// remove special style after closing
				setTimeout(()=>{ if(content) content.classList.remove('music-glow'); },300);
			}, buttonText:'Oke'});
		}

		// Attempt autoplay on load, then show intro popup regardless
		document.addEventListener('DOMContentLoaded', ()=>{
			if(bgMusic){
				bgMusic.play().then(()=>{
					musicPlaying = true; musicBtn.classList.add('playing'); musicBtn.textContent = 'üîä'; musicBtn.title='Hentikan Lagu';
				}).catch(()=>{
					// autoplay blocked - will wait for user action
				});
			}
			// show the intro popup with glow theme
			setTimeout(()=>{ showMusicIntro(); }, 250);
		});

	</script>
</body>
</html>

